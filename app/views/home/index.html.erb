<% content_for :javascript_includes do %>
  <script src="http://js.pusherapp.com/1.9/pusher.min.js" type="text/javascript"></script>

  <script type="text/javascript">
    // Enable pusher logging - don't include this in production
    Pusher.log = function(message) {
      if (window.console && window.console.log) window.console.log(message);
    };

    // Flash fallback logging - don't include this in production
    WEB_SOCKET_DEBUG = true;

    var pusher = new Pusher('f85901afd3e9eaff226f');
    var channel = pusher.subscribe('home');
    channel.bind('new_chat_line', function(data) {
	  	alert(data.entry);
		$('#chat_list').append($('<li>' + data.name + ': ' + data.entry + '</li>'));
    });
  </script>
<% end %>



<% if user_signed_in? %>
  	You are signed in as <%= current_user.username %>. <br />
  	<%= link_to "Sign out", destroy_user_session_path, :method => :delete %>.

	<%= form_tag(add_line_home_index_path, :method=>'post', :remote=>true) do %>
  		Message: <%= text_field_tag 'entry', nil, { :size => 70, :id => 'entry', :class => "input"} %>
  		<%= submit_tag "Say Something", { :class => "common_button" } %>
	<% end %>

	<br />
	<div id="chat_window" class="bordered">
  		<ul id="chat_list">
  		</ul>
	</div>
<% else %>
  	<%= form_for @user, :url => user_session_path do |f| %>
  	<div><%= f.label :email %><br />
  	<%= f.email_field :email %></div>
  	<div><%= f.label :password %><br />
  	<%= f.password_field :password %></div>
  	<div><%= f.check_box :remember_me %> <%= f.label :remember_me %></div>
  	<div><%= f.submit "Sign in" %></div>
  	<% end %>
  	<%= link_to "Sign in with Facebook", user_omniauth_authorize_path(:facebook) %> </br>
<% end %>
