<% content_for :javascript_includes do %>
  <script src="http://js.pusherapp.com/1.9/pusher.min.js" type="text/javascript"></script>
  <script type="text/javascript">
	$(document).ready(function() {
	  	// Enable pusher logging - don't include this in production
	    Pusher.log = function(message) {
	      if (window.console && window.console.log) window.console.log(message);
	    };

	    // Flash fallback logging - don't include this in production
	    WEB_SOCKET_DEBUG = true;

	    var pusher = new Pusher('f85901afd3e9eaff226f');
	    var channel = pusher.subscribe('home');
	    channel.bind('new_chat_line', function(data) {
		  	$('#chat_list').append($('<li>' + data.name + ': ' + data.entry + '</li>'));
	    });

		var user = <%= !current_user.nil? %>;

		if (user) {
			var stage = new Kinetic.Stage("container", 578, 200);

	   		var triangle = new Kinetic.Shape(function(color){
			    var context = this.getContext();
			    context.beginPath();
			    context.lineWidth = 4;
			    context.strokeStyle = "black";
			    context.fillStyle = color;
			    context.moveTo(120, 50);
			    context.lineTo(250, 80);
			    context.lineTo(150, 170);
			    context.closePath();
			    context.fill();
			    context.stroke();
			});

			triangle.addEventListener("click", function(){
			    triangle.color = triangle.color == "yellow" ? "#00D2FF" : "yellow";
			    triangle.draw(triangle.color);
			});

			// add custom property
			triangle.color = "#00D2FF";

			stage.add(triangle);
			triangle.draw(triangle.color);

			var circle = new Kinetic.Shape(function(color){
			    var canvas = this.getCanvas();
			    var context = this.getContext();
			    context.beginPath();
			    context.arc(380, canvas.height / 2, 70, 0, Math.PI * 2, true);
			    context.fillStyle = color;
			    context.fill();
			    context.lineWidth = 4;
			    context.stroke();
			});

			circle.addEventListener("click", function(){
			    circle.color = circle.color == "red" ? "#00d00f" : "red";
			    circle.draw(circle.color);
			});

			// add custom property
			circle.color = "red";

			stage.add(circle);
			circle.draw(circle.color);
		}
	});
  </script>
<% end %>



<% if user_signed_in? %>
  	You are signed in as <%= current_user.username %>. <br />
  	<%= link_to "Sign out", destroy_user_session_path, :method => :delete %>.

	<div id="container" style="width: 700px; height:300px">
	</div>

	<%= form_tag(add_line_home_index_path, :method=>'get', :remote=>true) do %>
  		Message: <%= text_field_tag 'entry', nil, { :size => 70, :id => 'entry', :class => "input"} %>
  		<%= submit_tag "Say Something", { :class => "common_button" } %>
	<% end %>

	<br />
	<div id="chat_window" class="bordered">
  		<ul id="chat_list">
  		</ul>
	</div>
<% else %>
  	<%= form_for @user, :url => user_session_path do |f| %>
  	<div><%= f.label :email %><br />
  	<%= f.email_field :email %></div>
  	<div><%= f.label :password %><br />
  	<%= f.password_field :password %></div>
  	<div><%= f.check_box :remember_me %> <%= f.label :remember_me %></div>
  	<div><%= f.submit "Sign in" %></div>
  	<% end %>
  	<%= link_to "Sign in with Facebook", user_omniauth_authorize_path(:facebook) %> </br>
<% end %>
