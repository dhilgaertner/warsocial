<% content_for :javascript_includes do %>
	<script src="http://js.pusherapp.com/1.9/pusher.min.js" type="text/javascript"></script>
	<script src="../../../Gameboard/communications.js" type="text/javascript"></script>
	<script src="../../../Gameboard/land.js" type="text/javascript"></script>
	<script src="../../../Gameboard/map.js" type="text/javascript"></script>
	<script src="../../../Gameboard/mapcanvas.js" type="text/javascript"></script>
	<script src="../../../Gameboard/player.js" type="text/javascript"></script>
	<script src="../../../Gameboard/shared.js" type="text/javascript"></script>
	<script src="../../../Gameboard/warsocial.js" type="text/javascript"></script>
  <script type="text/javascript">
	var global_game_name;
	$(document).ready(function() {
	  	// Enable pusher logging - don't include this in production
	    Pusher.log = function(message) {
	      if (window.console && window.console.log) window.console.log(message);
	    };

	    // Flash fallback logging - don't include this in production
	    WEB_SOCKET_DEBUG = true;
			var pusher = new Pusher('f85901afd3e9eaff226f');
	    var channel = pusher.subscribe("<%= @game.name %>");
	    channel.bind('new_chat_line', function(data) {
		  	$('#chat_list').append($('<li>' + data.name + ': ' + data.entry + '</li>'));
	    });
	
			channel.bind('game_start', function(data) {
		  	init(data)
	    });
			
			channel.bind('attack', function(data) {
		  	attack(data)
	    });
	
			global_game_name = "<%= @game.name %>";
			game = null;
			
			init(<%= @init_data.to_json.html_safe %>);
			
	});
  </script>
<% end %>

<% if user_signed_in? %>
	<%= link_to "Sit", add_line_home_index_path(:game_name => @game.name, :entry => "sit"), :remote=>true %>
	
	<div id="stage" style="position:relative; padding:0; margin:0 auto 0 auto; width:600px; height:400px;">
		<canvas id="canvas_shadow" width="600" height="400" style="z-index:0; position:absolute; left:0px; top:0px;">Your browser does not support the canvas element.</canvas>
		<canvas id="canvas_map" width="600" height="400" style="z-index:1; position:absolute; left:0px; top:0px;"></canvas>
		<canvas id="canvas_hilight_origin" width="600" height="400" style="z-index:2; position:absolute; left:0px; top:0px;"></canvas>
		<canvas id="canvas_hilight_destination" width="600" height="400" style="z-index:2; position:absolute; left:0px; top:0px;"></canvas>
	  <canvas id="canvas_dice" width="600" height="400" style="z-index:3; position:absolute; left:0px; top:0px;"></canvas>
	  <canvas id="canvas_dice_box" width="600" height="400" style="z-index:4; position:absolute; left:0px; top:0px;"></canvas>
		<%= image_tag("gameboard/texture.png", :id => 'pattern', :style => 'display:none') %>
		<%= image_tag("gameboard/dice1.png", :id => 'dice1', :style => 'display:none') %>
		<%= image_tag("gameboard/dice2.png", :id => 'dice2', :style => 'display:none') %>
		<%= image_tag("gameboard/dice3.png", :id => 'dice3', :style => 'display:none') %>
		<%= image_tag("gameboard/dice4.png", :id => 'dice4', :style => 'display:none') %>
		<%= image_tag("gameboard/dice5.png", :id => 'dice5', :style => 'display:none') %>
		<%= image_tag("gameboard/dice6.png", :id => 'dice6', :style => 'display:none') %>
		<%= image_tag("gameboard/dice_shadow.png", :id => 'dice_shadow', :style => 'display:none') %>
	</div>
	
	<div id="chat_window" class="bordered">
  		<ul id="chat_list">
  		</ul>
	</div>
	
	<center>
	<%= form_tag(add_line_home_index_path, :method=>'get', :remote=>true) do %>
		<%= hidden_field_tag 'game_name', @game.name %>
		<%= text_field_tag 'entry', nil, { :size => 70, :id => 'entry', :class => "input"} %>
		<%= submit_tag "Send", { :class => "common_button" } %>
	<% end %>
	</center>
<% else %>
  	<%= form_for @user, :url => user_session_path do |f| %>
  	<div><%= f.label :email %><br />
  	<%= f.email_field :email %></div>
  	<div><%= f.label :password %><br />
  	<%= f.password_field :password %></div>
  	<div><%= f.check_box :remember_me %> <%= f.label :remember_me %></div>
  	<div><%= f.submit "Sign in" %></div>
  	<% end %>
  	<%= link_to "Sign in with Facebook", user_omniauth_authorize_path(:facebook) %> </br>
<% end %>
